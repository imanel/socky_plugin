/*
Copyright 2006 Adobe Systems Incorporated
*/
function FABridge(a,b){this.target=a;this.remoteTypeCache={};this.remoteInstanceCache={};this.remoteFunctionCache={};this.localFunctionCache={};this.bridgeID=FABridge.nextBridgeID++;this.name=b;this.nextLocalFuncID=0;FABridge.instances[this.name]=this;FABridge.idMap[this.bridgeID]=this;return this}FABridge.TYPE_ASINSTANCE=1;FABridge.TYPE_ASFUNCTION=2;FABridge.TYPE_JSFUNCTION=3;FABridge.TYPE_ANONYMOUS=4;FABridge.initCallbacks={};FABridge.userTypes={};FABridge.addToUserTypes=function(){for(var i=0;i<arguments.length;i++){FABridge.userTypes[arguments[i]]={'typeName':arguments[i],'enriched':false}}}FABridge.argsToArray=function(a){var b=[];for(var i=0;i<a.length;i++){b[i]=a[i]}return b}function instanceFactory(a){this.fb_instance_id=a;return this}function FABridge__invokeJSFunction(a){var b=a[0];var c=a.concat();c.shift();var d=FABridge.extractBridgeFromID(b);return d.invokeLocalFunction(b,c)}FABridge.addInitializationCallback=function(a,b){var c=FABridge.instances[a];if(c!=undefined){b.call(c);return}var d=FABridge.initCallbacks[a];if(d==null){FABridge.initCallbacks[a]=d=[]}d.push(b)}function FABridge__bridgeInitialized(a){var b=document.getElementsByTagName("object");var c=b.length;var d=[];if(c>0){for(var i=0;i<c;i++){if(typeof b[i].SetVariable!="undefined"){d[d.length]=b[i]}}}var e=document.getElementsByTagName("embed");var f=e.length;var g=[];if(f>0){for(var j=0;j<f;j++){if(typeof e[j].SetVariable!="undefined"){g[g.length]=e[j]}}}var h=d.length;var n=g.length;var o="bridgeName="+a;if((h==1&&!n)||(h==1&&n==1)){FABridge.attachBridge(d[0],a)}else if(n==1&&!h){FABridge.attachBridge(g[0],a)}else{var p=false;if(h>1){for(var k=0;k<h;k++){var q=d[k].childNodes;for(var l=0;l<q.length;l++){var r=q[l];if(r.nodeType==1&&r.tagName.toLowerCase()=="param"&&r["name"].toLowerCase()=="flashvars"&&r["value"].indexOf(o)>=0){FABridge.attachBridge(d[k],a);p=true;break}}if(p){break}}}if(!p&&n>1){for(var m=0;m<n;m++){var s=g[m].attributes.getNamedItem("flashVars").nodeValue;if(s.indexOf(o)>=0){FABridge.attachBridge(g[m],a);break}}}}return true}FABridge.nextBridgeID=0;FABridge.instances={};FABridge.idMap={};FABridge.refCount=0;FABridge.extractBridgeFromID=function(a){var b=(a>>16);return FABridge.idMap[b]}FABridge.attachBridge=function(a,b){var c=new FABridge(a,b);FABridge[b]=c;var d=FABridge.initCallbacks[b];if(d==null){return}for(var i=0;i<d.length;i++){d[i].call(c)}delete FABridge.initCallbacks[b]}FABridge.blockedMethods={toString:true,get:true,set:true,call:true};FABridge.prototype={root:function(){return this.deserialize(this.target.getRoot())},releaseASObjects:function(){return this.target.releaseASObjects()},releaseNamedASObject:function(a){if(typeof(a)!="object"){return false}else{var b=this.target.releaseNamedASObject(a.fb_instance_id);return b}},create:function(a){return this.deserialize(this.target.create(a))},makeID:function(a){return(this.bridgeID<<16)+a},getPropertyFromAS:function(a,b){if(FABridge.refCount>0){throw new Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");}else{FABridge.refCount++;retVal=this.target.getPropFromAS(a,b);retVal=this.handleError(retVal);FABridge.refCount--;return retVal}},setPropertyInAS:function(a,b,c){if(FABridge.refCount>0){throw new Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");}else{FABridge.refCount++;retVal=this.target.setPropInAS(a,b,this.serialize(c));retVal=this.handleError(retVal);FABridge.refCount--;return retVal}},callASFunction:function(a,b){if(FABridge.refCount>0){throw new Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");}else{FABridge.refCount++;retVal=this.target.invokeASFunction(a,this.serialize(b));retVal=this.handleError(retVal);FABridge.refCount--;return retVal}},callASMethod:function(a,b,c){if(FABridge.refCount>0){throw new Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");}else{FABridge.refCount++;c=this.serialize(c);retVal=this.target.invokeASMethod(a,b,c);retVal=this.handleError(retVal);FABridge.refCount--;return retVal}},invokeLocalFunction:function(a,b){var c;var d=this.localFunctionCache[a];if(d!=undefined){c=this.serialize(d.apply(null,this.deserialize(b)))}return c},getTypeFromName:function(a){return this.remoteTypeCache[a]},createProxy:function(a,b){var c=this.getTypeFromName(b);instanceFactory.prototype=c;var d=new instanceFactory(a);this.remoteInstanceCache[a]=d;return d},getProxy:function(a){return this.remoteInstanceCache[a]},addTypeDataToCache:function(a){newType=new ASProxy(this,a.name);var b=a.accessors;for(var i=0;i<b.length;i++){this.addPropertyToType(newType,b[i])}var c=a.methods;for(var i=0;i<c.length;i++){if(FABridge.blockedMethods[c[i]]==undefined){this.addMethodToType(newType,c[i])}}this.remoteTypeCache[newType.typeName]=newType;return newType},addPropertyToType:function(b,d){var c=d.charAt(0);var e;var f;if(c>="a"&&c<="z"){f="get"+c.toUpperCase()+d.substr(1);e="set"+c.toUpperCase()+d.substr(1)}else{f="get"+d;e="set"+d}b[e]=function(a){this.bridge.setPropertyInAS(this.fb_instance_id,d,a)}b[f]=function(){return this.bridge.deserialize(this.bridge.getPropertyFromAS(this.fb_instance_id,d))}},addMethodToType:function(a,b){a[b]=function(){return this.bridge.deserialize(this.bridge.callASMethod(this.fb_instance_id,b,FABridge.argsToArray(arguments)))}},getFunctionProxy:function(a){var b=this;if(this.remoteFunctionCache[a]==null){this.remoteFunctionCache[a]=function(){b.callASFunction(a,FABridge.argsToArray(arguments))}}return this.remoteFunctionCache[a]},getFunctionID:function(a){if(a.__bridge_id__==undefined){a.__bridge_id__=this.makeID(this.nextLocalFuncID++);this.localFunctionCache[a.__bridge_id__]=a}return a.__bridge_id__},serialize:function(a){var b={};var t=typeof(a);if(t=="number"||t=="string"||t=="boolean"||t==null||t==undefined){b=a}else if(a instanceof Array){b=[];for(var i=0;i<a.length;i++){b[i]=this.serialize(a[i])}}else if(t=="function"){b.type=FABridge.TYPE_JSFUNCTION;b.value=this.getFunctionID(a)}else if(a instanceof ASProxy){b.type=FABridge.TYPE_ASINSTANCE;b.value=a.fb_instance_id}else{b.type=FABridge.TYPE_ANONYMOUS;b.value=a}return b},deserialize:function(a){var b;var t=typeof(a);if(t=="number"||t=="string"||t=="boolean"||a==null||a==undefined){b=this.handleError(a)}else if(a instanceof Array){b=[];for(var i=0;i<a.length;i++){b[i]=this.deserialize(a[i])}}else if(t=="object"){for(var i=0;i<a.newTypes.length;i++){this.addTypeDataToCache(a.newTypes[i])}for(var c in a.newRefs){this.createProxy(c,a.newRefs[c])}if(a.type==FABridge.TYPE_PRIMITIVE){b=a.value}else if(a.type==FABridge.TYPE_ASFUNCTION){b=this.getFunctionProxy(a.value)}else if(a.type==FABridge.TYPE_ASINSTANCE){b=this.getProxy(a.value)}else if(a.type==FABridge.TYPE_ANONYMOUS){b=a.value}}return b},addRef:function(a){this.target.incRef(a.fb_instance_id)},release:function(a){this.target.releaseRef(a.fb_instance_id)},handleError:function(a){if(typeof(a)=="string"&&a.indexOf("__FLASHERROR")==0){var b=a.split("||");if(FABridge.refCount>0){FABridge.refCount--}throw new Error(b[1]);return a}else{return a}}};ASProxy=function(a,b){this.bridge=a;this.typeName=b;return this};ASProxy.prototype={get:function(a){return this.bridge.deserialize(this.bridge.getPropertyFromAS(this.fb_instance_id,a))},set:function(a,b){this.bridge.setPropertyInAS(this.fb_instance_id,a,b)},call:function(a,b){this.bridge.callASMethod(this.fb_instance_id,a,b)},addRef:function(){this.bridge.addRef(this)},release:function(){this.bridge.release(this)}};